<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>F-Cut</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <script type="text/javascript" src="medidas.js"></script>
    <script type="text/javascript" src="size.point.js"></script>
    <script type="text/javascript" src="ajust.cut.js"></script>
    <script type="text/javascript" src="ajust.move.js"></script>
    <script type="text/javascript" src="rule_45deg.js"></script>
    <script type="text/javascript" src="draw.js"></script>
</head>

<body oncontextmenu="false">


    <span id="lt" class="sizes-viewport" angle="true"></span>
    <span id="rt" class="sizes-viewport" angle="true"></span>
    <span id="rb" class="sizes-viewport" angle="true"></span>
    <span id="lb" class="sizes-viewport" angle="true"></span>

    <span id="l" class="sizes-viewport" angle="false"></span>
    <span id="t" class="sizes-viewport" angle="false"></span>
    <span id="r" class="sizes-viewport" angle="false"></span>
    <span id="b" class="sizes-viewport" angle="false"></span>

    <div id="opacity" scalingAndMove="true"></div>

    <div id="holder_foto" scalingAndMove="true">
        <span id="lt-svg"></span>
        <span id="rt-svg"></span>
        <span id="rb-svg"></span>
        <span id="lb-svg"></span>

        <span id="l-svg"></span>
        <span id="t-svg"></span>
        <span id="r-svg"></span>
        <span id="b-svg"></span>

        <span id="line-w"></span>
        <span id="line-h"></span>
    </div>

    <div id="cut">
        <svg id="foto" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <image id="foto_image" ></image>
        </svg>

    </div>

    <img id="init-foto">


    <div id="size_div"></div>


    <div id="bottomBar">
        <rule-45deg>

        </rule-45deg>
    </div>

</body>

</html>

<style>
    * {
        padding: 0px;
        margin: 0px;
        outline: none;
        user-select: none;
    }
    
    html,
    body {
        width: 100%;
        height: 100%;
        background: #444;
        display: flex;
        justify-content: center;
        align-items: center;
        align-content: center;
        overflow: hidden;
        position: relative;
    }
    
    #opacity {
        width: 100%;
        height: 100%;
        background: #000;
        position: absolute;
        opacity: 0.7;
        z-index: 2;
    }
    
    #init-foto {
        z-index: 7;
        position: absolute;
        max-width: calc(100% - 20px);
        max-height: calc(100% - 110px);
        opacity: 0;
    }
    
    #foto {
        z-index: 1;
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 1;
        background: #00f;
        overflow: visible;
    }
    
    #foto_image {
        width: calc(100%);
        height: calc(100%);
    }
    
    #cut {
        position: absolute;
        z-index: 1;
        max-width: calc(100% - 20px);
        max-height: calc(100% - 110px);
    }
    
    #holder_foto {
        width: 100%;
        height: 100%;
        outline: #4499ff 2px solid;
        position: absolute;
        z-index: 3;
    }
    
    #size_div {
        position: absolute;
        z-index: -100;
        max-width: calc(100% - 20px);
        max-height: calc(100% - 110px);
        outline: none;
        opacity: 0;
    }
    
    [angle='true'] {
        width: 40px;
        height: 40px;
        display: block;
        background: none;
        position: absolute;
        z-index: 4;
    }
    
    [angle='false'] {
        width: 40px;
        height: 40px;
        display: block;
        background: none;
        position: absolute;
        z-index: 4;
    }
    
    #lt,
    #rt {
        top: 0px;
    }
    
    #lt,
    #lb {
        left: 0px;
    }
    
    #rt,
    #rb {
        right: 0px;
    }
    
    #lb,
    #rb {
        bottom: 0px;
    }
    
    #lt-svg {
        position: absolute;
        left: -10px;
        top: -10px;
        width: 20px;
        height: 20px;
        display: block;
        background: #4499ff;
        border-radius: 3px;
    }
    
    #rt-svg {
        position: absolute;
        right: -10px;
        top: -10px;
        width: 20px;
        height: 20px;
        display: block;
        background: #4499ff;
        border-radius: 3px;
    }
    
    #rb-svg {
        position: absolute;
        right: -10px;
        bottom: -10px;
        width: 20px;
        height: 20px;
        display: block;
        background: #4499ff;
        border-radius: 3px;
    }
    
    #lb-svg {
        position: absolute;
        left: -10px;
        bottom: -10px;
        width: 20px;
        height: 20px;
        display: block;
        background: #4499ff;
        border-radius: 3px;
    }
    
    #line-w {
        position: absolute;
        left: 0px;
        bottom: calc(100% / 3);
        width: 100%;
        height: calc(100% / 3);
        display: block;
        outline: #4499ff 2px solid;
    }
    
    #line-h {
        position: absolute;
        top: 0px;
        left: calc(100% / 3);
        height: 100%;
        width: calc(100% / 3);
        display: block;
        outline: #4499ff 2px solid;
    }
    
    #l-svg {
        position: absolute;
        top: calc(50% - 20px);
        left: -2.5px;
        height: 40px;
        width: 5px;
        display: block;
        background: #4499ff;
        border-radius: 3px;
    }
    
    #t-svg {
        position: absolute;
        left: calc(50% - 20px);
        top: -2.5px;
        width: 40px;
        height: 5px;
        display: block;
        background: #4499ff;
        border-radius: 3px;
    }
    
    #r-svg {
        position: absolute;
        top: calc(50% - 20px);
        right: -2.5px;
        height: 40px;
        width: 5px;
        display: block;
        background: #4499ff;
        border-radius: 3px;
    }
    
    #b-svg {
        position: absolute;
        left: calc(50% - 20px);
        bottom: -2.5px;
        width: 40px;
        height: 5px;
        display: block;
        background: #4499ff;
        border-radius: 3px;
    }
    
    #bottomBar::-webkit-scrollbar {
        display: none;
    }
    
    #bottomBar {
        position: absolute;
        width: 100%;
        height: 30px;
        bottom: 10px;
        left: 0px;
        z-index: 5;
    }
</style>



<script>
    let init_foto = document.querySelector("#init-foto");


    let holder_foto = document.querySelector("#holder_foto");
    let opacity = document.querySelector("#opacity");
    let size_div = document.querySelector("#size_div");
    let body = document.querySelector("body");

    let foto = document.querySelector("#foto");
    let foto_image = document.querySelector("#foto_image");

    let cut = document.querySelector("#cut");
    let size = document.querySelectorAll(".sizes-viewport");



    let containerX = 0;
    let containerY = 0;
    let fotoX = 0;
    let fotoY = 0;

    let lastDx = 0;
    let lastDy = 0;

    let factor = 0;
    let deg45 = 0;

    let img = new Image();
    img.src = "c.jpg";

    init_foto.src = img.src;

    img.onload = function() {

        cut.style.width = init_foto.getBoundingClientRect().width + px;
        cut.style.height = init_foto.getBoundingClientRect().height + px;

        init_foto.remove();
        draw();


    }

    function load() {
        ajustCut();
        ajustPointSize();

    }





    function initSvg(src) {


        /* foto.style.width = body.clientWidth + px;
        foto.style.height = body.clientHeight + px;
        foto.style.left = -cut.getBoundingClientRect().left + px;
        foto.style.top = -cut.getBoundingClientRect().top + px;
*/
        foto.setAttribute("viewBox", `0 0 ${foto.clientWidth} ${foto.clientHeight}`);
        foto_image.setAttribute("href", src);

        let fx = foto.getBoundingClientRect().width / 2;
        let fy = foto.getBoundingClientRect().height / 2;


        foto_image.setAttribute('transform', ` translate(${fx},${fy}) rotate(${deg45})`)
        foto_image.style.x = -fx;
        foto_image.style.y = -fy;

        load();
    }




    function svgMove() {

        foto.setAttribute("viewBox", `0 0 ${foto.clientWidth} ${foto.clientHeight}`);


        let fx = foto.getBoundingClientRect().width / 2;
        let fy = foto.getBoundingClientRect().height / 2;


        foto_image.setAttribute('transform', `   translate(${fx+ fotoX},${fy+ fotoY}) rotate(${deg45})`)
        foto_image.style.x = -fx;
        foto_image.style.y = -fy;

        load();
    }
</script>